\chapter{Experiments and Lab Work}\label{ch:experiment}
To relate the theory behind controlling pumps to the real world,
we conducted different experiments.
This helped to gain knowledge about the pump system,
to test controller implementations, and to gather the data needed for tuning of the controller.

\section{Data Acquisition}\label{sec:data_gathering}
The pump system is built as described in Chapter \ref{ch:physsetup},
with the controlling PC running xPC Target,
a real-time OS for use with SLRT. 

All data was collected with the help of custom made 
ML scripts and SLRT models.
The execution of these was done on the xPC Target OS.
Specific parts of these files will be explained in this chapter,
while the complete files can be found on the GitHub repository \cite{GitHub}.

To use SLRT on xPC targets, a SL model of the system was made on the host PC,
compiled, transferred over Ethernet and executed on the xPC target.
After the real-time execution is finished on the target,
the .dat files containing the recorded data have to be transferred back to the host,
where further analysis can be done.

To automate as much of this process as possible,
we created a ML script that updates and compiles the SL model, transfers it to the target,
starts the execution and copies the generated .dat files to the host.

\section{System Test}\label{sec:system_test} 
To obtain information about how the system reacts under different conditions,
a test was carried out with some example conditions.
From those conditions, the goal is to extrapolate an equation for the system,
that can estimate the systems reaction at different conditions.
To obtain the data needed,
a single pump is run at different speeds,
while flow resistance is varied by a choke valve,
resulting in corresponding values of flow, pressure, and energy consumption
measured by the sensors.
The measured data was stored for further analysis such as creating pump curves.

To get an overview over the whole operating range of the setup,
a very broad test was conducted.
We wanted to find the correlations between pump speed, backpressure, flow and power consumption.
To get reliable results, we chose to only change one variable at a time.
Since the value to be changed by our controller was expected to be the pump speed $\omega P_{1,2,3}$,
we decided to fix the backpressure by fixing the control valve position,
and stepwise change $\omega P_{1,2,3}$.
Since the three pumps in the setup are expected to be identical,
the test was only run with one of the pumps.
We chose to use pump 2 at random.

\section{Data Example}\label{sec:results}
A system test was performed, 
to capture live data of how the system would react, 
under various conditions.
The pump speed was gradually turned up from 0 to 100\% in intervals of 10\%. 
During each pump speed, the control valve was changed in 10\% intervals as well. 
For each change to the control valve, 
10 seconds of settling time was introduced, 
to let the control valve and backpressure stabilise.

Figure X shows the captured data for a test, with pump at 50\% speed and control valve at 50\%.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.8\textwidth]{figures/04ExperimentsAndLabWork/testrun}
	\vspace{-5mm}
	\caption{testrun}
	\label{fig:testrun}
\end{figure}
\missingfigure[figwidth=\textwidth]{Show curves from early test runs}